{% extends "base.html" %} {% block title %}Contact Ardur Healthcare{% endblock
%} {% block meta %}
<meta
    name="description"
    content="Contact Ardur Healthcare for expert billing and coding services. Get answers, request a demo, or schedule a free RCM consultation today."
/>
<link rel="canonical" href="{{ request.url }}" />
{% endblock %} {% block content %}
<div class="container mx-auto px-4 py-12">
    <div
        class="bg-white rounded-2xl shadow-2xl overflow-hidden lg:grid lg:grid-cols-2 lg:divide-x lg:divide-gray-200"
    >
        <div
            class="p-8 md:p-12 bg-gradient-to-br from-brand-secondary to-brand-light-blue relative"
        >
            <div
                class="absolute inset-0 opacity-20"
                style="
                    background: linear-gradient(
                        135deg,
                        #f0f9ff 0%,
                        #e0f2fe 50%,
                        #dbeafe 100%
                    );
                    background-size: cover;
                    background-position: center;
                "
            ></div>
            <div class="relative z-10">
                <h1
                    class="font-montserrat font-extrabold text-4xl md:text-5xl text-brand-dark mb-6 leading-tight"
                >
                    Connect with Ardur Healthcare
                </h1>
                <p class="text-gray-700 mb-10 text-lg leading-relaxed">
                    Have questions about our billing and coding services? Our
                    team is ready to help your practice streamline revenue with
                    confidence.
                </p>
                <p class="text-gray-600 mb-10 text-sm leading-relaxed">
                    By clicking the "Send Message" button, you agree to our
                    <a
                        href="{{ url_for('main.privacy_policy') }}"
                        class="text-brand-primary hover:underline"
                        >Privacy Policy</a
                    >.
                </p>
                <div class="space-y-6 mb-10">
                    <div class="flex items-center">
                        <i
                            class="ri-phone-line text-brand-primary text-3xl mr-5 flex-shrink-0"
                        ></i>
                        <div>
                            <h4 class="font-light text-brand-dark text-xl">
                                Call Us Anytime
                            </h4>
                            <a
                                href="tel:+17028092713"
                                class="text-gray-700 hover:text-brand-primary transition-colors duration-200 text-lg"
                            >
                                +1 (702) 809-2713
                            </a>
                        </div>
                    </div>
                    <div class="flex items-center">
                        <i
                            class="ri-mail-send-line text-brand-primary text-3xl mr-5 flex-shrink-0"
                        ></i>
                        <div>
                            <h4 class="font-light text-brand-dark text-xl">
                                Email Us
                            </h4>
                            <a
                                href="mailto:info@ardurhealthcare.com"
                                class="text-gray-700 hover:text-brand-primary transition-colors duration-200 text-lg"
                            >
                                info@ardurhealthcare.com
                            </a>
                        </div>
                    </div>
                    <div class="flex items-center">
                        <i
                            class="ri-map-pin-line text-brand-primary text-3xl mr-5 flex-shrink-0"
                        ></i>
                        <div>
                            <h4 class="font-light text-brand-dark text-xl">
                                Our Location
                            </h4>
                            <p class="text-gray-700 text-lg">
                                1964 Heritage Oaks St<br />
                                Las Vegas, NV 89119, United States
                            </p>
                            <a
                                href="https://maps.google.com/?q=1964+Heritage+Oaks+St,+Las+Vegas,+NV+89119,+United+States"
                                target="_blank"
                                rel="noopener noreferrer"
                                class="inline-flex items-center mt-2 text-brand-primary hover:text-brand-accent transition-colors duration-200"
                            >
                                <i class="ri-map-pin-fill mr-1"></i>
                                View on Google Maps
                            </a>
                        </div>
                    </div>
                </div>
                <div class="hidden lg:flex justify-center items-center mt-12">
                    <img
                        src="{{ url_for('static', filename='images/contact1.png') }}"
                        alt="Ardur Healthcare Team"
                        class="rounded-full w-64 h-64 object-cover border-4 border-white shadow-lg"
                    />
                </div>
            </div>
        </div>

        <div class="p-8 md:p-12 bg-white">
            <h2
                class="font-montserrat font-light text-3xl text-brand-dark mb-8"
            >
                Send us a Message
            </h2>
            {% with messages = get_flashed_messages(with_categories=true) %} {%
            if messages %}
            <div class="mb-6">
                {% for category, message in messages %}{% if category ==
                'success' %}
                <div
                    class="bg-green-50 border-l-4 border-green-500 text-green-800 p-4 rounded-md shadow-sm"
                    role="alert"
                >
                    <div class="flex">
                        <i
                            class="ri-check-circle-line text-green-500 text-xl mr-3 flex-shrink-0"
                        ></i>
                        <p class="font-medium">{{ message }}</p>
                    </div>
                </div>
                {% elif category == 'warning' %}
                <div
                    class="bg-yellow-50 border-l-4 border-yellow-400 text-yellow-800 p-4 rounded-md shadow-sm"
                    role="alert"
                >
                    <div class="flex">
                        <i
                            class="ri-alert-line text-yellow-500 text-xl mr-3 flex-shrink-0"
                        ></i>
                        <p class="font-medium">{{ message }}</p>
                    </div>
                </div>
                {% elif category == 'error' or category == 'danger' %}
                <div
                    class="bg-red-50 border-l-4 border-red-500 text-red-800 p-4 rounded-md shadow-sm"
                    role="alert"
                >
                    <div class="flex">
                        <i
                            class="ri-error-warning-line text-red-500 text-xl mr-3 flex-shrink-0"
                        ></i>
                        <p class="font-medium">{{ message }}</p>
                    </div>
                </div>
                {% else %}
                <div
                    class="bg-blue-50 border-l-4 border-blue-500 text-blue-800 p-4 rounded-md shadow-sm"
                    role="alert"
                >
                    <div class="flex">
                        <i
                            class="ri-information-line text-blue-500 text-xl mr-3 flex-shrink-0"
                        ></i>
                        <p class="font-medium">{{ message }}</p>
                    </div>
                </div>
                {% endif %} {% endfor %}
            </div>
            {% endif %} {% endwith %}
            <form
                method="POST"
                action="{{ url_for('contact.contact_form') }}"
                id="contact-form"
                class="space-y-4"
            >
                {{ form.hidden_tag() }}
                <div class="relative">
                    {{ form.name.label(class="absolute -top-2 left-3
                    inline-block text-xs text-gray-700 bg-brand-secondary px-1
                    z-10") }} {{ form.name(class="block w-full rounded-lg
                    border-gray-300 shadow-sm py-3 px-4 text-gray-900
                    placeholder:text-gray-400 focus:ring-2
                    focus:ring-brand-primary focus:border-brand-primary
                    sm:text-base transition-all duration-200 bg-brand-secondary
                    border-black") }} {% if form.name.errors %}
                    <div class="text-red-600 text-sm mt-2">
                        {% for error in form.name.errors %}<span
                            >{{ error }}</span
                        >{% endfor %}
                    </div>
                    {% endif %}
                </div>

                <div class="relative">
                    {{ form.email.label(class="absolute -top-2 left-3
                    inline-block text-xs text-gray-700 bg-brand-secondary px-1
                    z-10") }} {{ form.email(class="block w-full rounded-lg
                    border-gray-300 shadow-sm py-3 px-4 text-gray-900
                    placeholder:text-gray-400 focus:ring-2
                    focus:ring-brand-primary focus:border-brand-primary
                    sm:text-base transition-all duration-200 bg-brand-secondary
                    border-black") }} {% if form.email.errors %}
                    <div class="text-red-600 text-sm mt-2">
                        {% for error in form.email.errors %}<span
                            >{{ error }}</span
                        >{% endfor %}
                    </div>
                    {% endif %}
                </div>

                <div class="grid grid-cols-1 sm:grid-cols-2 gap-6">
                    <div class="relative">
                        <label
                            for="phone_country_code"
                            class="absolute -top-2 left-3 inline-block text-xs text-gray-700 bg-brand-secondary px-1 z-10"
                            >Country Code</label
                        >
                        <select
                            id="phone_country_code"
                            name="phone_country_code"
                            class="block w-full rounded-lg border-gray-300 shadow-sm py-3 px-4 text-gray-900 focus:ring-2 focus:ring-brand-primary focus:border-brand-primary sm:text-base transition-all duration-200 bg-brand-secondary border-black"
                        >
                            <option value="+1">+1 (USA)</option>
                            <option value="+91">+91 (India)</option>
                            <option value="+44">+44 (UK)</option>
                            <option value="+61">+61 (Australia)</option>
                            <option value="+971">+971 (UAE)</option>
                            <option value="+1">+1 (Canada)</option>
                            <option value="+52">+52 (Mexico)</option>
                            <option value="+49">+49 (Germany)</option>
                            <option value="+33">+33 (France)</option>
                            <option value="+81">+81 (Japan)</option>
                        </select>
                    </div>
                    <div class="relative">
                        {{ form.phone_number.label(class="absolute -top-2 left-3
                        inline-block text-xs text-gray-700 bg-brand-secondary
                        px-1 z-10") }} {{ form.phone_number(class="block w-full
                        rounded-lg border-gray-300 shadow-sm py-3 px-4
                        text-gray-900 placeholder:text-gray-400 focus:ring-2
                        focus:ring-brand-primary focus:border-brand-primary
                        sm:text-base transition-all duration-200
                        bg-brand-secondary border-black") }} {% if
                        form.phone_number.errors %}
                        <div class="text-red-600 text-sm mt-2">
                            {% for error in form.phone_number.errors %}<span
                                >{{ error }}</span
                            >{% endfor %}
                        </div>
                        {% endif %}
                    </div>
                </div>

                <div class="relative">
                    {{ form.practice.label(class="absolute -top-2 left-3
                    inline-block text-xs text-gray-700 bg-brand-secondary px-1
                    z-10") }} {{ form.practice(class="block w-full rounded-lg
                    border-gray-300 shadow-sm py-3 px-4 text-gray-900
                    placeholder:text-gray-400 focus:ring-2
                    focus:ring-brand-primary focus:border-brand-primary
                    sm:text-base transition-all duration-200 bg-brand-secondary
                    border-black") }} {% if form.practice.errors %}
                    <div class="text-red-600 text-sm mt-2">
                        {% for error in form.practice.errors %}<span
                            >{{ error }}</span
                        >{% endfor %}
                    </div>
                    {% endif %}
                </div>

                <div class="relative">
                    {{ form.state.label(class="absolute -top-2 left-3
                    inline-block text-xs text-gray-700 bg-brand-secondary px-1
                    z-10") }} {{ form.state(class="block w-full rounded-lg
                    border-gray-300 shadow-sm py-3 px-4 text-gray-900
                    placeholder:text-gray-400 focus:ring-2
                    focus:ring-brand-primary focus:border-brand-primary
                    sm:text-base transition-all duration-200 bg-brand-secondary
                    border-black") }} {% if form.state.errors %}
                    <div class="text-red-600 text-sm mt-2">
                        {% for error in form.state.errors %}<span
                            >{{ error }}</span
                        >{% endfor %}
                    </div>
                    {% endif %}
                </div>

                <div class="relative">
                    {{ form.service_type.label(class="absolute -top-2 left-3
                    inline-block text-xs text-gray-700 bg-brand-secondary px-1
                    z-10") }} {{ form.service_type(class="block w-full
                    rounded-lg border-gray-300 shadow-sm py-3 px-4 text-gray-900
                    focus:ring-2 focus:ring-brand-primary
                    focus:border-brand-primary sm:text-base transition-all
                    duration-200 bg-brand-secondary border-black") }} {% if
                    form.service_type.errors %}
                    <div class="text-red-600 text-sm mt-2">
                        {% for error in form.service_type.errors %}<span
                            >{{ error }}</span
                        >{% endfor %}
                    </div>
                    {% endif %}
                </div>

                <div class="relative">
                    <label
                        for="specialties-search"
                        class="absolute -top-2 left-3 inline-block text-xs text-gray-700 bg-brand-secondary px-1 z-10"
                        >Specialties</label
                    >
                    <input
                        type="text"
                        id="specialties-search"
                        placeholder="Type to search specialties..."
                        class="block w-full rounded-lg border-gray-300 shadow-sm py-3 px-4 text-gray-900 placeholder:text-gray-400 focus:ring-2 focus:ring-brand-primary focus:border-brand-primary sm:text-base transition-all duration-200 bg-brand-secondary border-black"
                        autocomplete="off"
                    />
                    <!-- Hidden input for form submission -->
                    <input
                        type="hidden"
                        name="specialties"
                        id="specialties-hidden"
                        value="{{ form.specialties.data or '' }}"
                    />
                    <div
                        id="specialties-dropdown"
                        class="absolute z-20 w-full bg-white border border-gray-300 rounded-lg shadow-lg mt-1 max-h-60 overflow-y-auto hidden"
                    >
                        <!-- Dynamic specialty options will be populated here -->
                    </div>
                    {% if form.specialties.errors %}
                    <div class="text-red-600 text-sm mt-2">
                        {% for error in form.specialties.errors %}
                        <span>{{ error }}</span>
                        {% endfor %}
                    </div>
                    {% endif %}
                </div>

                <div class="relative">
                    {{ form.monthly_insurance.label(class="absolute -top-2
                    left-3 inline-block text-xs text-gray-700 bg-brand-secondary
                    px-1 z-10") }} {{ form.monthly_insurance(class="block w-full
                    rounded-lg border-gray-300 shadow-sm py-3 px-4 text-gray-900
                    placeholder:text-gray-400 focus:ring-2
                    focus:ring-brand-primary focus:border-brand-primary
                    sm:text-base transition-all duration-200 bg-brand-secondary
                    border-black", placeholder="Enter average monthly insurance
                    collections (e.g., 25000)") }} {% if
                    form.monthly_insurance.errors %}
                    <div class="text-red-600 text-sm mt-2">
                        {% for error in form.monthly_insurance.errors %}<span
                            >{{ error }}</span
                        >{% endfor %}
                    </div>
                    {% endif %}
                    <div class="text-gray-500 text-xs mt-1">
                        Please enter your practice's average monthly insurance
                        collections in USD
                    </div>
                </div>

                <div class="grid grid-cols-1 sm:grid-cols-2 gap-6">
                    <div class="relative">
                        {{ form.preferred_appointment_date.label(class="absolute
                        -top-2 left-3 inline-block text-xs text-gray-700
                        bg-brand-secondary px-1 z-10") }} {{
                        form.preferred_appointment_date(type="date",
                        class="block w-full rounded-lg border-gray-300 shadow-sm
                        py-3 px-4 text-gray-900 focus:ring-2
                        focus:ring-brand-primary focus:border-brand-primary
                        sm:text-base transition-all duration-200
                        bg-brand-secondary border-black") }} {% if
                        form.preferred_appointment_date.errors %}
                        <div class="text-red-600 text-sm mt-2">
                            {% for error in
                            form.preferred_appointment_date.errors %}<span
                                >{{ error }}</span
                            >{% endfor %}
                        </div>
                        {% endif %}
                    </div>

                    <div class="relative">
                        {{ form.preferred_time_slot.label(class="absolute -top-2
                        left-3 inline-block text-xs text-gray-700
                        bg-brand-secondary px-1 z-10") }} {{
                        form.preferred_time_slot(class="block w-full rounded-lg
                        border-gray-300 shadow-sm py-3 px-4 text-gray-900
                        focus:ring-2 focus:ring-brand-primary
                        focus:border-brand-primary sm:text-base transition-all
                        duration-200 bg-brand-secondary border-black") }} {% if
                        form.preferred_time_slot.errors %}
                        <div class="text-red-600 text-sm mt-2">
                            {% for error in form.preferred_time_slot.errors
                            %}<span>{{ error }}</span>{% endfor %}
                        </div>
                        {% endif %}
                    </div>
                </div>

                <div class="relative">
                    {{ form.subject.label(class="absolute -top-2 left-3
                    inline-block text-xs text-gray-700 bg-brand-secondary px-1
                    z-10") }} {{ form.subject(class="block w-full rounded-lg
                    border-gray-300 shadow-sm py-3 px-4 text-gray-900
                    placeholder:text-gray-400 focus:ring-2
                    focus:ring-brand-primary focus:border-brand-primary
                    sm:text-base transition-all duration-200 bg-brand-secondary
                    border-black") }} {% if form.subject.errors %}
                    <div class="text-red-600 text-sm mt-2">
                        {% for error in form.subject.errors %}<span
                            >{{ error }}</span
                        >{% endfor %}
                    </div>
                    {% endif %}
                </div>

                <div class="relative">
                    {{ form.message.label(class="absolute -top-2 left-3
                    inline-block text-xs text-gray-700 bg-brand-secondary px-1
                    z-10") }} {{ form.message(rows=6, class="block w-full
                    rounded-lg border-gray-300 shadow-sm py-3 px-4 text-gray-900
                    placeholder:text-gray-400 focus:ring-2
                    focus:ring-brand-primary focus:border-brand-primary
                    sm:text-base transition-all duration-200 bg-brand-secondary
                    border-black") }} {% if form.message.errors %}
                    <div class="text-red-600 text-sm mt-2">
                        {% for error in form.message.errors %}<span
                            >{{ error }}</span
                        >{% endfor %}
                    </div>
                    {% endif %}
                </div>

                <div class="flex items-center">
                    {{ form.privacy_policy_agreement(class="mr-3 rounded
                    border-gray-300 text-brand-primary
                    focus:ring-brand-primary") }}
                    <label
                        for="privacy_policy_agreement"
                        class="text-sm text-gray-700"
                    >
                        I agree to the
                        <a
                            href="{{ url_for('main.privacy_policy') }}"
                            class="text-brand-primary hover:underline"
                            target="_blank"
                            >Privacy Policy</a
                        >
                    </label>
                    {% if form.privacy_policy_agreement.errors %}
                    <div class="text-red-600 text-sm mt-2 ml-6">
                        {% for error in form.privacy_policy_agreement.errors %}
                        <span>{{ error }}</span>
                        {% endfor %}
                    </div>
                    {% endif %}
                </div>

                <div>
                    {{ form.submit(id="submit-btn", class="w-full
                    bg-brand-primary text-white font-montserrat font-light
                    text-lg px-6 py-4 rounded-lg hover:scale-105
                    hover:bg-brand-dark hover:shadow-xl transition duration-300
                    cursor-pointer focus:outline-none focus:ring-2
                    focus:ring-brand-primary focus:ring-offset-2") }}

                    <!-- Loading state button (hidden by default) -->
                    <button
                        type="button"
                        id="loading-btn"
                        class="w-full bg-gray-400 text-white font-montserrat font-light text-lg px-6 py-4 rounded-lg cursor-not-allowed hidden"
                        disabled
                    >
                        <div class="flex items-center justify-center">
                            <svg
                                class="animate-spin -ml-1 mr-3 h-5 w-5 text-white"
                                xmlns="http://www.w3.org/2000/svg"
                                fill="none"
                                viewBox="0 0 24 24"
                            >
                                <circle
                                    class="opacity-25"
                                    cx="12"
                                    cy="12"
                                    r="10"
                                    stroke="currentColor"
                                    stroke-width="4"
                                ></circle>
                                <path
                                    class="opacity-75"
                                    fill="currentColor"
                                    d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"
                                ></path>
                            </svg>
                            Sending Message...
                        </div>
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<script>
    document.addEventListener("DOMContentLoaded", function () {
        // 🚀 PERFORMANCE OPTIMIZATION: Add form submission loading state
        const form = document.getElementById("contact-form");
        const submitBtn = document.getElementById("submit-btn");
        const loadingBtn = document.getElementById("loading-btn");

        form.addEventListener("submit", function (e) {
            // Show loading state immediately for better UX
            submitBtn.classList.add("hidden");
            loadingBtn.classList.remove("hidden");

            // Disable form inputs to prevent double submission
            const inputs = form.querySelectorAll(
                "input, select, textarea, button",
            );
            inputs.forEach((input) => {
                input.disabled = true;
            });

            // Add visual feedback to the form
            form.style.opacity = "0.7";
            form.style.pointerEvents = "none";
        });

        const specialtiesInput = document.getElementById("specialties-search");
        const dropdown = document.getElementById("specialties-dropdown");
        const hiddenInput = document.getElementById("specialties-hidden");
        let specialtiesList = [];
        let selectedSpecialties = [];

        // Load initial specialties data
        fetch("/api/specialties")
            .then((response) => response.json())
            .then((data) => {
                specialtiesList = data;
                console.log("Loaded specialties:", specialtiesList.length);
            })
            .catch((error) =>
                console.error("Error loading specialties:", error),
            );

        // Initialize with existing value if any
        if (hiddenInput && hiddenInput.value.trim()) {
            selectedSpecialties = hiddenInput.value
                .split(",")
                .map((s) => s.trim())
                .filter((s) => s);
            updateInputDisplay();
        }

        specialtiesInput.addEventListener("input", function () {
            const query = this.value.toLowerCase().trim();

            // Clear validation errors
            clearValidationErrors();

            if (query.length < 1) {
                hideDropdown();
                return;
            }

            // Filter specialties based on query
            const filtered = specialtiesList
                .filter(
                    (specialty) =>
                        specialty.toLowerCase().includes(query) &&
                        !selectedSpecialties.includes(specialty),
                )
                .slice(0, 10);

            showDropdown(filtered, query);
        });

        specialtiesInput.addEventListener("keydown", function (e) {
            clearValidationErrors();

            if (e.key === "Enter") {
                e.preventDefault();
                const query = this.value.trim();
                if (query && !selectedSpecialties.includes(query)) {
                    selectedSpecialties.push(query);
                    updateInputDisplay();
                    this.value = "";
                    hideDropdown();
                }
            } else if (
                e.key === "Backspace" &&
                this.value === "" &&
                selectedSpecialties.length > 0
            ) {
                selectedSpecialties.pop();
                updateInputDisplay();
            }
        });

        specialtiesInput.addEventListener("focus", function () {
            clearValidationErrors();
        });

        specialtiesInput.addEventListener("blur", function () {
            setTimeout(() => hideDropdown(), 150);
        });

        function showDropdown(items, query) {
            dropdown.innerHTML = "";

            // Add filtered items
            items.forEach((item) => {
                const div = document.createElement("div");
                div.className =
                    "px-4 py-2 hover:bg-gray-100 cursor-pointer border-b border-gray-100";
                div.textContent = item;
                div.addEventListener("click", function () {
                    addSpecialty(item);
                });
                dropdown.appendChild(div);
            });

            // Add option to add custom specialty
            if (
                query &&
                !items.some(
                    (item) => item.toLowerCase() === query.toLowerCase(),
                ) &&
                !selectedSpecialties.includes(query)
            ) {
                const customDiv = document.createElement("div");
                customDiv.className =
                    "px-4 py-2 hover:bg-blue-50 cursor-pointer border-b border-gray-100 text-blue-600 font-medium";
                customDiv.innerHTML = `<i class="ri-add-line mr-2"></i>Add "${query}"`;
                customDiv.addEventListener("click", function () {
                    addSpecialty(query);
                });
                dropdown.appendChild(customDiv);
            }

            dropdown.classList.remove("hidden");
        }

        function hideDropdown() {
            dropdown.classList.add("hidden");
        }

        function addSpecialty(specialty) {
            if (!selectedSpecialties.includes(specialty)) {
                clearValidationErrors();
                selectedSpecialties.push(specialty);
                console.log("Added specialty:", specialty);
                updateInputDisplay();
                specialtiesInput.value = "";
                hideDropdown();
            }
        }

        function updateInputDisplay() {
            // Update hidden input value
            hiddenInput.value = selectedSpecialties.join(", ");
            console.log("Updated hidden input value:", hiddenInput.value);

            // Update placeholder
            if (selectedSpecialties.length > 0) {
                specialtiesInput.placeholder = `${selectedSpecialties.length} specialties selected. Type to add more...`;
            } else {
                specialtiesInput.placeholder = "Type to search specialties...";
            }

            // Show selected specialties as tags
            let tagsContainer = document.getElementById("specialty-tags");
            if (!tagsContainer) {
                tagsContainer = document.createElement("div");
                tagsContainer.id = "specialty-tags";
                tagsContainer.className = "flex flex-wrap gap-2 mt-2";
                specialtiesInput.parentNode.appendChild(tagsContainer);
            }

            tagsContainer.innerHTML = "";
            selectedSpecialties.forEach((specialty, index) => {
                const tag = document.createElement("span");
                tag.className =
                    "inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-brand-primary text-white";
                tag.innerHTML = `
                    ${specialty}
                    <button type="button" class="ml-1 text-white hover:text-gray-200" onclick="removeSpecialty(${index})">
                        <i class="ri-close-line"></i>
                    </button>
                `;
                tagsContainer.appendChild(tag);
            });

            clearValidationErrors();
        }

        function clearValidationErrors() {
            const errorDiv = document.getElementById("specialties-error");
            if (errorDiv) {
                errorDiv.remove();
            }
            specialtiesInput.classList.remove("border-red-500");
        }

        function showValidationError() {
            let errorDiv = document.getElementById("specialties-error");
            if (!errorDiv) {
                errorDiv = document.createElement("div");
                errorDiv.id = "specialties-error";
                errorDiv.className = "text-red-600 text-sm mt-2";
                specialtiesInput.parentNode.appendChild(errorDiv);
            }
            errorDiv.innerHTML =
                "<span>Please select at least one specialty.</span>";
            specialtiesInput.classList.add("border-red-500");
        }

        // Global function to remove specialty
        window.removeSpecialty = function (index) {
            selectedSpecialties.splice(index, 1);
            updateInputDisplay();
        };

        // Click outside to close dropdown
        document.addEventListener("click", function (e) {
            if (
                !specialtiesInput.contains(e.target) &&
                !dropdown.contains(e.target)
            ) {
                hideDropdown();
            }
        });

        // Form validation
        const form = document.getElementById("contact-form");
        if (form) {
            form.addEventListener("submit", function (e) {
                console.log("Form submission started");
                console.log("Selected specialties:", selectedSpecialties);

                // Ensure hidden input is updated
                hiddenInput.value = selectedSpecialties.join(", ");
                console.log("Final hidden input value:", hiddenInput.value);

                // Validate specialties
                if (selectedSpecialties.length === 0) {
                    console.log("Validation failed: No specialties selected");
                    e.preventDefault();
                    showValidationError();
                    specialtiesInput.focus();
                    return false;
                } else {
                    console.log("Validation passed: Specialties selected");
                    clearValidationErrors();
                }

                // Form can proceed
                return true;
            });
        }
    });
</script>
{% endblock %}
